You are reviewing a metric specification for a reproducible pipeline that compares US economic/market performance under Democratic vs Republican presidents.

Please review the spec for:
1) Ambiguities / missing assumptions (frequency alignment, annualization, start/end choices, etc.).
2) Cherry-picking risks and how to mitigate (paired metrics, alternates, reporting conventions).
3) Data-source pitfalls (revisions, seasonal adjustment, coverage, licensing/TOS constraints).
4) Missing key metrics or better defaults for v1.
5) Spec structure improvements that make implementations/testability easier.

Output format:
- Top issues/suggestions (High/Med/Low severity) with a short rationale.
- Proposed spec edits (concrete YAML/rationale changes).
- Questions you would ask before implementation.

=== spec/metrics_v1.yaml ===
version: 1
name: metrics_v1
created: "2026-02-09"
description: >
  v1 metric registry for the initial D-vs-R scoreboard. This file defines:
  (1) base series pulled from online sources, and (2) derived metrics and
  term-level aggregations.

  Notes:
  - All percent units are in "percentage points" unless otherwise stated.
  - For growth/return metrics, we prefer log-diff annualization unless noted.
  - Term attribution (e.g., inauguration lag) is configured elsewhere; this file
    only specifies metric definitions.

sources:
  fred:
    kind: csv
    url_template: "https://fred.stlouisfed.org/graph/fredgraph.csv?id={series_id}"
    notes:
      - "No API key required for fredgraph.csv downloads."
  nber:
    kind: json
    url: "https://data.nber.org/data/cycles/business_cycle_dates.json"
  ken_french_ff_factors:
    kind: zip_csv
    url: "https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_Factors_CSV.zip"
    encoding: latin-1
    notes:
      - "Monthly Fama/French factors; includes Mkt-RF and RF in percent."

series:
  # Macro: output
  gdpc1_real_gdp:
    source: fred
    series_id: GDPC1
    frequency: Q
    units: "billions of chained dollars (SAAR)"
    description: "Real Gross Domestic Product (BEA)."
  a939rx0q048sbea_real_gdp_per_capita:
    source: fred
    series_id: A939RX0Q048SBEA
    frequency: Q
    units: "chained dollars per person"
    description: "Real GDP per capita (BEA)."

  # Labor market
  payems_payroll_employment:
    source: fred
    series_id: PAYEMS
    frequency: M
    units: "thousands of persons"
    description: "All Employees: Total Nonfarm Payrolls (BLS CES, SA)."
  ce16ov_household_employment:
    source: fred
    series_id: CE16OV
    frequency: M
    units: "thousands of persons"
    description: "Civilian Employment Level (BLS CPS)."
  unrate_unemployment_rate:
    source: fred
    series_id: UNRATE
    frequency: M
    units: "percent"
    description: "Civilian Unemployment Rate (BLS CPS, SA)."

  # Prices
  cpiaucsl_cpi:
    source: fred
    series_id: CPIAUCSL
    frequency: M
    units: "index"
    description: "CPI-U: All Items (BLS, SA)."
    seasonal_adjustment: SA
  cpiaucns_cpi_unadjusted:
    source: fred
    series_id: CPIAUCNS
    frequency: M
    units: "index"
    description: "CPI-U: All Items (BLS, not seasonally adjusted)."
    seasonal_adjustment: NSA
  pcepi_pce_price_index:
    source: fred
    series_id: PCEPI
    frequency: M
    units: "index"
    description: "PCE Price Index (BEA, SA)."
    seasonal_adjustment: SA

  # Business cycle labels
  usrec_recession_indicator:
    source: fred
    series_id: USREC
    frequency: M
    units: "0/1 indicator"
    description: "NBER based Recession Indicators for the United States."
  nber_business_cycle_dates:
    source: nber
    frequency: irregular
    units: "peaks/troughs"
    description: "NBER business cycle chronology (peaks/troughs)."

  # Fiscal (note: some fiscal series are annual/fiscal-year based)
  gfdegdq188s_federal_debt_pct_gdp:
    source: fred
    series_id: GFDEGDQ188S
    frequency: Q
    units: "percent of GDP"
    description: "Federal Debt: Total Public Debt as Percent of GDP."
  fyfsgda188s_federal_surplus_deficit_pct_gdp:
    source: fred
    series_id: FYFSGDA188S
    frequency: A
    units: "percent of GDP"
    description: "Federal Surplus or Deficit [-] as Percent of GDP (annual)."

  # Finance (returns)
  ff_factors_monthly:
    source: ken_french_ff_factors
    dataset: "F-F_Research_Data_Factors"
    frequency: M
    units: "percent"
    columns:
      mkt_rf: "Mkt-RF"
      rf: "RF"
    derived_columns:
      mkt_total:
        expr: "mkt_rf + rf"
        units: "percent"
    description: "Fama/French Research Factors (monthly)."

  # Finance (index levels; price-only, excludes dividends)
  sp500_sp500_index:
    source: fred
    series_id: SP500
    frequency: D
    units: "index"
    description: "S&P 500 index level (daily; price index, excludes dividends)."
  djia_dow_jones:
    source: fred
    series_id: DJIA
    frequency: D
    units: "index"
    description: "Dow Jones Industrial Average index level (daily; price index, excludes dividends)."

metrics:
  # GDP growth
  - id: gdp_growth_real_qoq_ann_logdiff
    family: gdp_growth
    primary: true
    label: "Real GDP growth (QoQ annualized, log diff)"
    inputs:
      series: gdpc1_real_gdp
    period_transform:
      kind: growth_rate
      method: logdiff
      lag: 1
      annualize_periods_per_year: 4
      scale: 100
      notes:
        - "Formula: 100 * 4 * ln(GDPC1_t / GDPC1_{t-1})."
    term_aggregation:
      kind: mean

  - id: gdp_growth_real_percap_qoq_ann_logdiff
    family: gdp_growth
    primary: false
    label: "Real GDP per capita growth (QoQ annualized, log diff)"
    inputs:
      series: a939rx0q048sbea_real_gdp_per_capita
    period_transform:
      kind: growth_rate
      method: logdiff
      lag: 1
      annualize_periods_per_year: 4
      scale: 100
      notes:
        - "Formula: 100 * 4 * ln(RGDPPC_t / RGDPPC_{t-1})."
    term_aggregation:
      kind: mean

  - id: gdp_growth_real_term_cagr
    family: gdp_growth
    primary: false
    label: "Real GDP growth (term CAGR from start/end)"
    inputs:
      series: gdpc1_real_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: cagr_from_levels
      periods_per_year: 4
      scale: 100
      notes:
        - "Uses first/last observation in the attributed window."

  # Employment
  - id: payroll_jobs_change_total
    family: jobs
    primary: true
    label: "Payroll employment change (total, end minus start)"
    inputs:
      series: payems_payroll_employment
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start
      units: "thousands of persons"

  - id: payroll_jobs_change_per_year
    family: jobs
    primary: false
    label: "Payroll employment change (per year, end minus start divided by term years)"
    inputs:
      series: payems_payroll_employment
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start_per_year
      units: "thousands of persons per year"

  - id: household_employment_change_total
    family: jobs
    primary: false
    label: "Household employment change (CPS, total, end minus start)"
    inputs:
      series: ce16ov_household_employment
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start
      units: "thousands of persons"

  - id: household_employment_change_per_year
    family: jobs
    primary: false
    label: "Household employment change (CPS, per year, end minus start divided by term years)"
    inputs:
      series: ce16ov_household_employment
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start_per_year
      units: "thousands of persons per year"

  # Unemployment
  - id: unemployment_rate_mean
    family: unemployment
    primary: true
    label: "Unemployment rate (mean during term)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean
      units: "percent"

  - id: unemployment_rate_change_pp
    family: unemployment
    primary: false
    label: "Unemployment rate change (percentage points, end minus start)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start
      units: "percentage points"

  - id: unemployment_rate_change_pp_per_year
    family: unemployment
    primary: false
    label: "Unemployment rate change (percentage points per year, end minus start divided by term years)"
    inputs:
      series: unrate_unemployment_rate
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start_per_year
      units: "percentage points per year"

  # Inflation
  - id: cpi_inflation_yoy_mean
    family: inflation
    primary: false
    label: "CPI inflation (YoY, mean during term; based on SA CPI index)"
    inputs:
      series: cpiaucsl_cpi
    period_transform:
      kind: pct_change
      lag: 12
      scale: 100
      notes:
        - "Formula: 100 * (CPI_t / CPI_{t-12} - 1)."
    term_aggregation:
      kind: mean
      units: "percent"

  - id: cpi_inflation_yoy_mean_nsa
    family: inflation
    primary: true
    label: "CPI inflation (YoY, mean during term; based on unadjusted CPI index)"
    inputs:
      series: cpiaucns_cpi_unadjusted
    period_transform:
      kind: pct_change
      lag: 12
      scale: 100
      notes:
        - "Formula: 100 * (CPI_t / CPI_{t-12} - 1)."
    term_aggregation:
      kind: mean
      units: "percent"

  - id: pce_inflation_yoy_mean
    family: inflation
    primary: false
    label: "PCE inflation (YoY, mean during term)"
    inputs:
      series: pcepi_pce_price_index
    period_transform:
      kind: pct_change
      lag: 12
      scale: 100
    term_aggregation:
      kind: mean
      units: "percent"

  - id: cpi_inflation_mom_ann_logdiff_mean
    family: inflation
    primary: false
    label: "CPI inflation (MoM annualized, log diff, mean during term)"
    inputs:
      series: cpiaucsl_cpi
    period_transform:
      kind: growth_rate
      method: logdiff
      lag: 1
      annualize_periods_per_year: 12
      scale: 100
      notes:
        - "Formula: 100 * 12 * ln(CPI_t / CPI_{t-1})."
    term_aggregation:
      kind: mean
      units: "percent"

  # Stock returns (excess)
  - id: ff_mkt_excess_return_ann_compound
    family: stock_returns
    primary: true
    label: "Stock market excess return (annualized, compounded; Ken French Mkt-RF)"
    inputs:
      table: ff_factors_monthly
      column: mkt_rf
    period_transform:
      kind: identity
      notes:
        - "Input is percent simple return per month."
    term_aggregation:
      kind: compound_annualized
      periods_per_year: 12
      input_units: "percent"
      output_units: "percent"

  - id: ff_mkt_excess_return_ann_arith
    family: stock_returns
    primary: false
    label: "Stock market excess return (annualized, arithmetic; Ken French Mkt-RF)"
    inputs:
      table: ff_factors_monthly
      column: mkt_rf
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean_times_periods_per_year
      periods_per_year: 12
      units: "percent"

  - id: ff_mkt_total_return_ann_compound
    family: stock_returns
    primary: false
    label: "Stock market total return (annualized, compounded; Ken French Mkt-RF + RF)"
    inputs:
      table: ff_factors_monthly
      column: mkt_total
    period_transform:
      kind: identity
      notes:
        - "Derived monthly total return: (Mkt-RF + RF), in percent simple return per month."
    term_aggregation:
      kind: compound_annualized
      periods_per_year: 12
      input_units: "percent"
      output_units: "percent"

  - id: ff_mkt_total_return_term_total
    family: stock_returns
    primary: false
    label: "Stock market total return (term total, compounded; Ken French Mkt-RF + RF)"
    inputs:
      table: ff_factors_monthly
      column: mkt_total
    period_transform:
      kind: identity
    term_aggregation:
      kind: compound_total
      input_units: "percent"
      output_units: "percent"
      notes:
        - "Formula: 100 * (prod_t (1 + r_t/100) - 1) over months in the attributed term window."

  # Stock index levels (price-only)
  - id: sp500_term_pct_change
    family: stock_levels
    primary: false
    label: "S&P 500 percent change (term total, end vs start)"
    inputs:
      series: sp500_sp500_index
    period_transform:
      kind: identity
    term_aggregation:
      kind: pct_change_from_levels
      scale: 100
      units: "percent"

  - id: sp500_term_cagr_pct
    family: stock_levels
    primary: false
    label: "S&P 500 CAGR (term annualized from start/end)"
    inputs:
      series: sp500_sp500_index
    period_transform:
      kind: identity
    term_aggregation:
      kind: cagr_from_levels
      scale: 100
      use_actual_time: true
      units: "percent"
      notes:
        - "Uses start/end levels and actual elapsed time to annualize."

  - id: djia_term_pct_change
    family: stock_levels
    primary: false
    label: "Dow Jones Industrial Average percent change (term total, end vs start)"
    inputs:
      series: djia_dow_jones
    period_transform:
      kind: identity
    term_aggregation:
      kind: pct_change_from_levels
      scale: 100
      units: "percent"

  - id: djia_term_cagr_pct
    family: stock_levels
    primary: false
    label: "Dow Jones Industrial Average CAGR (term annualized from start/end)"
    inputs:
      series: djia_dow_jones
    period_transform:
      kind: identity
    term_aggregation:
      kind: cagr_from_levels
      scale: 100
      use_actual_time: true
      units: "percent"
      notes:
        - "Uses start/end levels and actual elapsed time to annualize."

  # Recessions
  - id: recession_month_share
    family: recessions
    primary: true
    label: "Recession share of months (USREC mean)"
    inputs:
      series: usrec_recession_indicator
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean
      post_scale: 100
      units: "percent of months"

  - id: recession_start_count
    family: recessions
    primary: false
    label: "Recession starts (count of 0->1 transitions in USREC)"
    inputs:
      series: usrec_recession_indicator
    period_transform:
      kind: identity
    term_aggregation:
      kind: count_transitions
      from_value: 0
      to_value: 1
      units: "count"

  # Fiscal
  - id: federal_debt_pct_gdp_mean
    family: fiscal
    primary: true
    label: "Federal debt (%GDP, mean; GFDEGDQ188S)"
    inputs:
      series: gfdegdq188s_federal_debt_pct_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean
      units: "percent of GDP"

  - id: federal_debt_pct_gdp_end
    family: fiscal
    primary: false
    label: "Federal debt (%GDP, end-of-term value; GFDEGDQ188S)"
    inputs:
      series: gfdegdq188s_federal_debt_pct_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: last
      units: "percent of GDP"

  - id: federal_debt_pct_gdp_change_pp
    family: fiscal
    primary: false
    label: "Federal debt (%GDP, change in percentage points, end minus start; GFDEGDQ188S)"
    inputs:
      series: gfdegdq188s_federal_debt_pct_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start
      units: "percentage points"

  - id: federal_debt_pct_gdp_change_pp_per_year
    family: fiscal
    primary: false
    label: "Federal debt (%GDP, change in percentage points per year; GFDEGDQ188S)"
    inputs:
      series: gfdegdq188s_federal_debt_pct_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: end_minus_start_per_year
      units: "percentage points per year"

  - id: federal_surplus_deficit_pct_gdp_mean
    family: fiscal
    primary: false
    label: "Federal surplus/deficit (%GDP, mean; FYFSGDA188S)"
    inputs:
      series: fyfsgda188s_federal_surplus_deficit_pct_gdp
    period_transform:
      kind: identity
    term_aggregation:
      kind: mean
      units: "percent of GDP"


=== spec/metrics_rationale.md ===
# Metrics Rationale (v1)

This document explains the key measurement choices in `spec/metrics_v1.yaml`. The goal is to make disagreements about "Dem vs Rep performance" explicit and auditable: if you disagree, you can point to a specific metric id or spec field, propose an alternative, and we can add it as an alternate definition rather than silently changing results.

## General Conventions

- Prefer pulling **level series** (indexes/levels) from upstream and computing transforms locally. This keeps formulas explicit and avoids ambiguous upstream "units" transformations.
- Prefer **log-diff annualization** for growth rates when starting from level series:
  - QoQ annualized growth: `100 * 4 * ln(x_t / x_{t-1})`
  - MoM annualized inflation: `100 * 12 * ln(x_t / x_{t-1})`
- For rates already expressed in percent (e.g., `UNRATE`), use levels and differences (percentage points) rather than re-scaling.
- Term attribution (lag rules, inauguration handling, etc.) is **not** a metric decision; it is controlled by the join/attribution config and recorded in the run manifest.

## Prices / Inflation (MoM, QoQ, YoY, SAAR)

Question: should we use precomputed MoM/QoQ/YoY series vs computing from price levels?

Choice (v1): **compute inflation from price index levels** (e.g., CPI, PCEPI), and explicitly support both seasonally adjusted (SA) and not seasonally adjusted (NSA) CPI where it matters.

Rationale:
- CPI/PCE are published as **index levels**, not SAAR levels. "SAAR" is an annualization convention typically applied to growth rates (and to some BEA flow/level series like GDP levels), not to CPI levels.
- Computing locally makes the exact formula unambiguous (pct-change vs log-diff; annualized vs not).
- Many "precomputed inflation" series are either not available as plain downloads without special API parameters, or embed transformation assumptions we still need to document.

We include multiple inflation definitions because people argue about them:
- `cpi_inflation_yoy_mean_nsa` (primary): YoY inflation from the **unadjusted** CPI index, averaged over the attributed window.
  - Pros: YoY does not require seasonal adjustment; avoids annual revision of seasonally adjusted CPI levels due to seasonal factor updates.
- `cpi_inflation_yoy_mean` (alternate): YoY inflation from the **seasonally adjusted** CPI index, averaged over the attributed window.
  - Pros: included for completeness; should be very close to the NSA YoY in most periods.
- `cpi_inflation_mom_ann_logdiff_mean` (alternate): MoM annualized log-diff inflation, averaged over the window.
  - Pros: faster-moving signal; matches common "annualized monthly inflation" discussions.
  - Note: for MoM measures, we prefer SA CPI because NSA MoM is dominated by seasonal patterns.
- `pce_inflation_yoy_mean` (alternate): PCE-based inflation.

Seasonal adjustment:
- The BLS produces **both unadjusted and seasonally adjusted CPI data**; SA data are intended for short-term trend analysis, while unadjusted data are widely used for escalation/indexation and other applications.
- SA CPI series are revised when seasonal factors are updated (typically revising recent history), so “latest data” pulls can change SA values in the recent window; caching raw downloads keeps our runs reproducible, but we still surface this as a choice.
- For the PCE price index (`PCEPI`), the monthly series in FRED is **seasonally adjusted**. We compute YoY from that level series; if we later want a non-seasonally-adjusted PCE price index, FRED provides other formats (e.g., annual NSA) but those are not a drop-in replacement for monthly term windows.

## Output (GDP)

`GDPC1` is a **quarterly level in SAAR units** (real GDP at an annual rate). We still compute growth locally from the level series (log-diff annualized). This is standard and keeps the growth formula consistent with other growth metrics.

We include alternates:
- real GDP per capita growth
- term CAGR computed from start/end levels (useful for start/end comparisons, but more sensitive to window rules)

## Stock Market: Returns vs Levels (MoM/QoQ/YoY)

Question: do we need levels, not just returns?

Choice (v1): use **Ken French monthly returns** as the primary stock market source, and **derive level-like metrics** via compounding.

Rationale:
- Returns are the cleanest unit for comparisons (stationary-ish, not dependent on an arbitrary base year).
- "Level" comparisons (e.g., S&P 500 start vs end) are common in popular claims, so we should support them, but they are highly sensitive to window endpoints. We treat those as **alternate views**.

Ken French dataset:
- Monthly observations: **1926-07 through 2025-12** in the current file (the header indicates it was created using the **202512** CRSP database).
- Our pipeline should re-download on `--refresh` and cache the raw zip so results are reproducible from cached artifacts even if the upstream file changes later.

Metrics included:
- `ff_mkt_excess_return_ann_compound` (primary): annualized compound excess return (Mkt-RF).
- `ff_mkt_total_return_ann_compound` (alternate): annualized compound total return (Mkt-RF + RF).
- `ff_mkt_total_return_term_total` (alternate): compounded total return over the term window (end/start in percent terms).

Price index levels (Dow and S&P):
- For popular/press-style “the market went up/down under X” claims, we also include **price index levels** from FRED:
  - `SP500` (S&P 500)
  - `DJIA` (Dow Jones Industrial Average)
- These are **price-only** indices (exclude dividends), so they are not directly comparable to total return measures. We treat them as alternates for public-facing level claims, not the primary return metric.

Level-style term metrics included:
- Term total percent change (end vs start): `sp500_term_pct_change`, `djia_term_pct_change`
- Term percent change per year (CAGR, annualized from start/end using elapsed time): `sp500_term_cagr_pct`, `djia_term_cagr_pct`

MoM/QoQ/YoY:
- MoM is the monthly return itself.
- QoQ/YoY are rolling compounded returns over 3/12 months. We have not made these primary scoreboard metrics yet; they are better suited for plots/diagnostics because they overlap heavily over time.

## Employment: End-minus-start vs Per-year

Question: why include `end_minus_start_per_year`?

Choice (v1): keep **total change** as primary and per-year as an alternate, and apply the same pairing across comparable series to avoid cherry-picking accusations.

Rationale:
- Total change (`end_minus_start`) is the most direct answer to “how many jobs were added during this window.”
- Per-year normalization helps when:
  - we compare windows of different lengths (partial terms, alternate lag rules),
  - we want a rough rate comparable across terms.
- Per-year implicitly assumes linearity; it’s not a structural model. We treat it as a convenience view, not the canonical truth.

Anti-cherry-picking policy:
- If we include a per-year version for a metric family, we also include the total-change version (and vice versa).
- Reports should display both side-by-side for the same underlying series to prevent “we picked the normalization that looks best” critiques.

We include both payroll (CES) and household (CPS) employment series to reflect the measurement split in labor statistics.

## Fiscal: Percent of GDP vs Dollars

Choice (v1): start with percent-of-GDP series when available (`GFDEGDQ188S`, `FYFSGDA188S`) because it reduces inflation/scale issues and matches much of the public discourse.

Notes:
- Fiscal series are often annual or fiscal-year based; mapping to presidential windows requires extra care (and must be documented in the attribution manifest).

## What We Still Need To Decide (Likely v2)

- Whether to add a FRED-based stock price index series (e.g., S&P 500) and how to downsample daily data (end-of-month vs average).
- Whether to support point-in-time/vintage data for key series (ALFRED) to avoid revision effects in historical reproducibility.

